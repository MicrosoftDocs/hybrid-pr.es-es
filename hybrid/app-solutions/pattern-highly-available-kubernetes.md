---
title: Patrón de alta disponibilidad de Kubernetes mediante Azure y Azure Stack Hub
description: Averigüe cómo una solución de clúster de Kubernetes proporciona alta disponibilidad mediante Azure y Azure Stack Hub.
author: BryanLa
ms.topic: article
ms.date: 12/03/2020
ms.author: bryanla
ms.reviewer: bryanla
ms.lastreviewed: 12/03/2020
ms.openlocfilehash: 454cc0a0531882b7a8ec050a461420ce13eebcfe
ms.sourcegitcommit: df7e3e6423c3d4e8a42dae3d1acfba1d55057258
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/09/2020
ms.locfileid: "96912006"
---
# <a name="high-availability-kubernetes-cluster-pattern"></a><span data-ttu-id="ce8a1-103">Patrón de clúster de Kubernetes de alta disponibilidad</span><span class="sxs-lookup"><span data-stu-id="ce8a1-103">High availability Kubernetes cluster pattern</span></span>

<span data-ttu-id="ce8a1-104">En este artículo se describe cómo diseñar y usar una infraestructura de alta disponibilidad basada en Kubernetes con el motor de Azure Kubernetes Service (AKS) en Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-104">This article describes how to architect and operate a highly available Kubernetes-based infrastructure using Azure Kubernetes Service (AKS) Engine on Azure Stack Hub.</span></span> <span data-ttu-id="ce8a1-105">Este escenario es común para las organizaciones con cargas de trabajo críticas en entornos regulados y muy restringidos.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-105">This scenario is common for organizations with critical workloads in highly restricted and regulated environments.</span></span> <span data-ttu-id="ce8a1-106">Organizaciones de dominios como finanzas, defensa y gobierno.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-106">Organizations in domains such as finance, defense, and government.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="ce8a1-107">Contexto y problema</span><span class="sxs-lookup"><span data-stu-id="ce8a1-107">Context and problem</span></span>

<span data-ttu-id="ce8a1-108">Muchas organizaciones desarrollan soluciones nativas de la nube que aprovechan los servicios y tecnologías de vanguardia como Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-108">Many organizations are developing cloud-native solutions that leverage state-of-the-art services and technologies like Kubernetes.</span></span> <span data-ttu-id="ce8a1-109">Aunque Azure proporciona centros de datos en la mayoría de las regiones del mundo, a veces hay casos de uso y escenarios excepcionales en los que las aplicaciones críticas para la empresa deben ejecutarse en una ubicación específica.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-109">Although Azure provides datacenters in most regions of the world, sometimes there are edge use-cases and scenarios where business critical applications must run in a specific location.</span></span> <span data-ttu-id="ce8a1-110">Entre las consideraciones se incluyen las siguientes:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-110">Considerations include:</span></span>

- <span data-ttu-id="ce8a1-111">Distinción de ubicación</span><span class="sxs-lookup"><span data-stu-id="ce8a1-111">Location sensitivity</span></span>
- <span data-ttu-id="ce8a1-112">Latencia entre la aplicación y los sistemas locales</span><span class="sxs-lookup"><span data-stu-id="ce8a1-112">Latency between the application and on-premises systems</span></span>
- <span data-ttu-id="ce8a1-113">Conservación del ancho de banda</span><span class="sxs-lookup"><span data-stu-id="ce8a1-113">Bandwidth conservation</span></span>
- <span data-ttu-id="ce8a1-114">Conectividad</span><span class="sxs-lookup"><span data-stu-id="ce8a1-114">Connectivity</span></span>
- <span data-ttu-id="ce8a1-115">Requisitos normativos o legales</span><span class="sxs-lookup"><span data-stu-id="ce8a1-115">Regulatory or statutory requirements</span></span>

<span data-ttu-id="ce8a1-116">Azure, en combinación con Azure Stack Hub, aborda la mayoría de estos problemas.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-116">Azure, in combination with Azure Stack Hub, addresses most of these concerns.</span></span> <span data-ttu-id="ce8a1-117">A continuación se describe un amplio conjunto de opciones, decisiones y consideraciones a tener en cuenta para una implementación correcta de Kubernetes que se ejecute en Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-117">A broad set of options, decisions, and considerations for a successful implementation of Kubernetes running on Azure Stack Hub is described below.</span></span>

## <a name="solution"></a><span data-ttu-id="ce8a1-118">Solución</span><span class="sxs-lookup"><span data-stu-id="ce8a1-118">Solution</span></span>

<span data-ttu-id="ce8a1-119">En este patrón se supone que tenemos que tratar con un conjunto estricto de restricciones.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-119">This pattern assumes that we have to deal with a strict set of constraints.</span></span> <span data-ttu-id="ce8a1-120">La aplicación debe ejecutarse de forma local y ningún dato personal debe llegar a los servicios en la nube pública.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-120">The application must run on-premises and all personal data must not reach public cloud services.</span></span> <span data-ttu-id="ce8a1-121">Los datos de supervisión y aquellos otros que no constituyan información de identificación personal se pueden enviar a Azure para su procesamiento.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-121">Monitoring and other non-PII data can be sent to Azure and be processed there.</span></span> <span data-ttu-id="ce8a1-122">Se puede acceder a servicios externos como, por ejemplo, a una instancia de Container Registry pública o a otros, pero tendrían que filtrarse mediante un servidor proxy o firewall.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-122">External services like a public Container Registry or others can be accessed but might be filtered through a firewall or proxy server.</span></span>

<span data-ttu-id="ce8a1-123">La aplicación de ejemplo que se muestra aquí (basada en el [Taller de Azure Kubernetes Service](/learn/modules/aks-workshop/)) está diseñada para usar soluciones nativas de Kubernetes siempre que sea posible.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-123">The sample application shown here (based on [Azure Kubernetes Service Workshop](/learn/modules/aks-workshop/)) is designed to use Kubernetes-native solutions whenever possible.</span></span> <span data-ttu-id="ce8a1-124">Este diseño evita la dependencia del proveedor, en lugar de usar servicios nativos de la plataforma.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-124">This design avoids vendor lock-in, instead of using platform-native services.</span></span> <span data-ttu-id="ce8a1-125">Por ejemplo, la aplicación usa un back-end de base de datos de MongoDB autohospedado en lugar de un servicio PaaS o un servicio externo de bases de datos.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-125">As an example, the application uses a self-hosted MongoDB database backend instead of a PaaS service or external database service.</span></span>

<span data-ttu-id="ce8a1-126">[![Patrón híbrido de aplicación](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-126">[![Application Pattern Hybrid](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span></span>

<span data-ttu-id="ce8a1-127">En el diagrama anterior se muestra la arquitectura de la aplicación de ejemplo que se ejecuta en Kubernetes en Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-127">The preceding diagram illustrates the application architecture of the sample application running on Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="ce8a1-128">La aplicación consta de varios componentes, entre los que se incluyen:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-128">The app consists of several components, including:</span></span>

 1) <span data-ttu-id="ce8a1-129">Un clúster de Kubernetes basado en el motor de AKS en Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-129">An AKS Engine based Kubernetes cluster on Azure Stack Hub.</span></span>
 2) <span data-ttu-id="ce8a1-130">[cert-manager](https://www.jetstack.io/cert-manager/), que proporciona un conjunto de herramientas para la administración de certificados en Kubernetes y que se usa para solicitar automáticamente los certificados de Let's Encrypt.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-130">[cert-manager](https://www.jetstack.io/cert-manager/), which provides a suite of tools for certificate management in Kubernetes, used to automatically request certificates from Let's Encrypt.</span></span>
 3) <span data-ttu-id="ce8a1-131">Un espacio de nombres de Kubernetes que contiene los componentes de la aplicación para el front-end (ratings-web), la API (ratings-api) y la base de datos (ratings-mongodb).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-131">A Kubernetes namespace that contains the application components for the front end (ratings-web), api (ratings-api), and database (ratings-mongodb).</span></span>
 4) <span data-ttu-id="ce8a1-132">El controlador de entrada que enruta el tráfico HTTP/HTTPS a los puntos de conexión del clúster de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-132">The Ingress Controller that routes HTTP/HTTPS traffic to endpoints within the Kubernetes cluster.</span></span>

<span data-ttu-id="ce8a1-133">Se usa la aplicación de ejemplo para mostrar la arquitectura de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-133">The sample application is used to illustrate the application architecture.</span></span> <span data-ttu-id="ce8a1-134">Todos los componentes son ejemplos.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-134">All components are examples.</span></span> <span data-ttu-id="ce8a1-135">La arquitectura contiene solo la implementación de una única aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-135">The architecture contains only a single application deployment.</span></span> <span data-ttu-id="ce8a1-136">Para lograr una alta disponibilidad, se ejecutará la implementación al menos dos veces en dos instancias diferentes de Azure Stack Hub: pueden ejecutarse en la misma ubicación o en dos (o más) sitios diferentes:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-136">To achieve high availability (HA), we'll run the deployment at least twice on two different Azure Stack Hub instances - they can run either in the same location or in two (or more) different sites:</span></span>

![Arquitectura de la infraestructura](media/pattern-highly-available-kubernetes/aks-azure-architecture.png)

<span data-ttu-id="ce8a1-138">Los servicios como Azure Container Registry, Azure Monitor y otros, se hospedan fuera de Azure Stack Hub en Azure o en el entorno local.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-138">Services like Azure Container Registry, Azure Monitor, and others, are hosted outside Azure Stack Hub in Azure or on-premises.</span></span> <span data-ttu-id="ce8a1-139">Este diseño híbrido protege la solución frente a posibles interrupciones de una sola instancia de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-139">This hybrid design protects the solution against outage of a single Azure Stack Hub instance.</span></span>

## <a name="components"></a><span data-ttu-id="ce8a1-140">Componentes</span><span class="sxs-lookup"><span data-stu-id="ce8a1-140">Components</span></span>

<span data-ttu-id="ce8a1-141">Esta arquitectura global consta de los siguientes componentes:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-141">The overall architecture consists of the following components:</span></span>

<span data-ttu-id="ce8a1-142">**Azure Stack Hub** es una extensión de Azure que puede ejecutar cargas de trabajo en un entorno local y proporcionar servicios de Azure en su centro de datos.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-142">**Azure Stack Hub** is an extension of Azure that can run workloads in an on-premises environment by providing Azure services in your datacenter.</span></span> <span data-ttu-id="ce8a1-143">Vaya a [Introducción a Azure Stack Hub](/azure-stack/operator/azure-stack-overview) para más información.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-143">Go to [Azure Stack Hub overview](/azure-stack/operator/azure-stack-overview) to learn more.</span></span>

<span data-ttu-id="ce8a1-144">**Motor de Azure Kubernetes Service (motor de AKS)** es el motor que está detrás de la oferta de servicio de Kubernetes administrado, Azure Kubernetes Service (AKS), que está disponible en Azure en la actualidad.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-144">**Azure Kubernetes Service Engine (AKS Engine)** is the engine behind the managed Kubernetes service offering, Azure Kubernetes Service (AKS), that is available in Azure today.</span></span> <span data-ttu-id="ce8a1-145">En el caso de Azure Stack Hub, el motor de AKS nos permite implementar, escalar y actualizar clústeres de Kubernetes autoadministrados y con todas las características mediante las funcionalidades de IaaS de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-145">For Azure Stack Hub, AKS Engine allows us to deploy, scale, and upgrade fully featured, self-managed Kubernetes clusters using Azure Stack Hub's IaaS capabilities.</span></span> <span data-ttu-id="ce8a1-146">Vaya a [Introducción al motor de AKS](https://github.com/Azure/aks-engine) para más información.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-146">Go to [AKS Engine Overview](https://github.com/Azure/aks-engine) to learn more.</span></span>

<span data-ttu-id="ce8a1-147">Vaya a [Problemas y limitaciones conocidos](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) para más información sobre las diferencias entre el motor de AKS en Azure y el motor de AKS en Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-147">Go to [Known Issues and Limitations](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) to learn more about the differences between AKS Engine on Azure and AKS Engine on Azure Stack Hub.</span></span>

<span data-ttu-id="ce8a1-148">**Azure Virtual Network (VNet)** se usa para proporcionar la infraestructura de red en cada instancia de Azure Stack Hub para las máquinas virtuales que hospedan la infraestructura de clústeres de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-148">**Azure Virtual Network (VNet)** is used to provide the network infrastructure on each Azure Stack Hub for the Virtual Machines (VMs) hosting the Kubernetes cluster infrastructure.</span></span>

<span data-ttu-id="ce8a1-149">**Azure Load Balancer** se usa para el punto de conexión de API de Kubernetes y el controlador de entrada Nginx.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-149">**Azure Load Balancer** is used for the Kubernetes API Endpoint and the Nginx Ingress Controller.</span></span> <span data-ttu-id="ce8a1-150">El equilibrador de carga enruta el tráfico externo (por ejemplo, Internet) hacia los nodos y máquinas virtuales que ofrecen un servicio específico.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-150">The load balancer routes external (for example, Internet) traffic to nodes and VMs offering a specific service.</span></span>

<span data-ttu-id="ce8a1-151">**Azure Container Registry (ACR)** se usa para almacenar imágenes privadas de Docker y charts de Helm, los cuales están implementados en el clúster.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-151">**Azure Container Registry (ACR)** is used to store private Docker images and Helm charts, which are deployed to the cluster.</span></span> <span data-ttu-id="ce8a1-152">El motor de AKS se puede autenticar con Container Registry mediante una identidad de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-152">AKS Engine can authenticate with the Container Registry using an Azure AD identity.</span></span> <span data-ttu-id="ce8a1-153">Kubernetes no requiere ACR.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-153">Kubernetes doesn't require ACR.</span></span> <span data-ttu-id="ce8a1-154">Puede usar otros registros de contenedor, como Docker Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-154">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="ce8a1-155">**Azure Repos** es un conjunto de herramientas de control de versiones que se puede usar para administrar el código.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-155">**Azure Repos** is a set of version control tools that you can use to manage your code.</span></span> <span data-ttu-id="ce8a1-156">También puede usar GitHub u otros repositorios basados en Git.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-156">You can also use GitHub or other git-based repositories.</span></span> <span data-ttu-id="ce8a1-157">Vaya a [Introducción a Azure Repos](/azure/devops/repos/get-started/what-is-repos) para más información.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-157">Go to [Azure Repos Overview](/azure/devops/repos/get-started/what-is-repos) to learn more.</span></span>

<span data-ttu-id="ce8a1-158">**Azure Pipelines** forma parte de Azure DevOps Services y ejecuta compilaciones, pruebas e implementaciones automatizadas.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-158">**Azure Pipelines** is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="ce8a1-159">También puede usar soluciones de CI/CD de terceros como Jenkins.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-159">You can also use third-party CI/CD solutions such as Jenkins.</span></span> <span data-ttu-id="ce8a1-160">Vaya a [Introducción a Azure Pipeline](/azure/devops/pipelines/get-started/what-is-azure-pipelines) para más información.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-160">Go to [Azure Pipeline Overview](/azure/devops/pipelines/get-started/what-is-azure-pipelines) to learn more.</span></span>

<span data-ttu-id="ce8a1-161">**Azure Monitor** recopila y almacena métricas y registros, como las métricas de la plataforma de los servicios de Azure de la solución y los datos de telemetría de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-161">**Azure Monitor** collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="ce8a1-162">Use estos datos para supervisar la aplicación, configurar alertas y paneles y realizar el análisis de causa principal de los errores.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-162">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="ce8a1-163">Azure Monitor se integra con Kubernetes para recopilar métricas de controladores, nodos y contenedores, así como los registros de contenedor y los registros del nodo maestro.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-163">Azure Monitor integrates with Kubernetes to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span> <span data-ttu-id="ce8a1-164">Vaya a [Introducción a Azure Monitor](/azure/azure-monitor/overview) para más información.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-164">Go to [Azure Monitor Overview](/azure/azure-monitor/overview) to learn more.</span></span>

<span data-ttu-id="ce8a1-165">**Azure Traffic Manager** es un equilibrador de carga de tráfico basado en DNS que le permite distribuir el tráfico de forma óptima a servicios de diferentes regiones de Azure o implementaciones de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-165">**Azure Traffic Manager** is a DNS-based traffic load balancer that enables you to distribute traffic optimally to services across different Azure regions or Azure Stack Hub deployments.</span></span> <span data-ttu-id="ce8a1-166">Traffic Manager también proporciona alta disponibilidad y capacidad de respuesta.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-166">Traffic Manager also provides high availability and responsiveness.</span></span> <span data-ttu-id="ce8a1-167">Los puntos de conexión de la aplicación deben ser accesibles desde el exterior.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-167">The application endpoints must be accessible from the outside.</span></span> <span data-ttu-id="ce8a1-168">También hay otras soluciones locales disponibles.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-168">There are other on-premises solutions available as well.</span></span>

<span data-ttu-id="ce8a1-169">**El controlador de entrada Kubernetes** expone rutas HTTP(S) a los servicios de un clúster de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-169">**Kubernetes Ingress Controller** exposes HTTP(S) routes to services in a Kubernetes cluster.</span></span> <span data-ttu-id="ce8a1-170">Para este fin se puede usar Nginx o cualquier controlador de entrada adecuado.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-170">Nginx or any suitable ingress controller can be used for this purpose.</span></span>

<span data-ttu-id="ce8a1-171">**Helm** es un administrador de paquetes para la implementación de Kubernetes que ofrece una manera de agrupar diferentes objetos de Kubernetes, como implementaciones, servicios y secretos, en un solo "chart".</span><span class="sxs-lookup"><span data-stu-id="ce8a1-171">**Helm** is a package manager for Kubernetes deployment, providing a way to bundle different Kubernetes objects like Deployments, Services, Secrets, into a single "chart".</span></span> <span data-ttu-id="ce8a1-172">Puede publicar, implementar, controlar la administración de versiones y actualizar un objeto de chart.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-172">You can publish, deploy, control version management, and update a chart  object.</span></span> <span data-ttu-id="ce8a1-173">Azure Container Registry puede usarse como repositorio para almacenar charts de Helm empaquetados.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-173">Azure Container Registry can be used as a repository to store packaged Helm Charts.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="ce8a1-174">Consideraciones de diseño</span><span class="sxs-lookup"><span data-stu-id="ce8a1-174">Design considerations</span></span>

<span data-ttu-id="ce8a1-175">Este patrón sigue algunas consideraciones de alto nivel que se explican con más detalle en las secciones siguientes de este artículo:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-175">This pattern follows a few high-level considerations explained in more detail in the next sections of this article:</span></span>

- <span data-ttu-id="ce8a1-176">La aplicación usa soluciones nativas de Kubernetes para evitar la dependencia del proveedor.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-176">The application uses Kubernetes-native solutions, to avoid vendor lock-in.</span></span>
- <span data-ttu-id="ce8a1-177">La aplicación usa una arquitectura de microservicios.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-177">The application uses a microservices architecture.</span></span>
- <span data-ttu-id="ce8a1-178">Azure Stack Hub no necesita conectividad de entrada, pero permite la conectividad saliente de Internet.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-178">Azure Stack Hub doesn't need inbound but allows outbound Internet connectivity.</span></span>

<span data-ttu-id="ce8a1-179">Estos procedimientos recomendados serán aplicables también a cargas de trabajo y escenarios reales.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-179">These recommended practices will apply to real-world workloads and scenarios as well.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="ce8a1-180">Consideraciones sobre escalabilidad</span><span class="sxs-lookup"><span data-stu-id="ce8a1-180">Scalability considerations</span></span>

<span data-ttu-id="ce8a1-181">La escalabilidad es importante para proporcionar a los usuarios acceso coherente, confiable y con un buen rendimiento a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-181">Scalability is important to provide users consistent, reliable, and well-performing access to the application.</span></span>

<span data-ttu-id="ce8a1-182">El escenario de ejemplo cubre la escalabilidad en varios niveles de la pila de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-182">The sample scenario covers scalability on multiple layers of the application stack.</span></span> <span data-ttu-id="ce8a1-183">A continuación se muestra una descripción detallada de los distintos niveles:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-183">Here's a high-level overview of the different layers:</span></span>

| <span data-ttu-id="ce8a1-184">Nivel de arquitectura</span><span class="sxs-lookup"><span data-stu-id="ce8a1-184">Architecture level</span></span> | <span data-ttu-id="ce8a1-185">Afecta a</span><span class="sxs-lookup"><span data-stu-id="ce8a1-185">Affects</span></span> | <span data-ttu-id="ce8a1-186">¿Cómo lo hago?</span><span class="sxs-lookup"><span data-stu-id="ce8a1-186">How?</span></span> |
| --- | --- | ---
| <span data-ttu-id="ce8a1-187">Application</span><span class="sxs-lookup"><span data-stu-id="ce8a1-187">Application</span></span> | <span data-ttu-id="ce8a1-188">Application</span><span class="sxs-lookup"><span data-stu-id="ce8a1-188">Application</span></span> | <span data-ttu-id="ce8a1-189">Escalado horizontal basado en el número de pods/réplicas/instancias de contenedor\*</span><span class="sxs-lookup"><span data-stu-id="ce8a1-189">Horizontal scaling based on the number of Pods/Replicas/Container Instances\*</span></span> |
| <span data-ttu-id="ce8a1-190">Clúster</span><span class="sxs-lookup"><span data-stu-id="ce8a1-190">Cluster</span></span> | <span data-ttu-id="ce8a1-191">Clúster de Kubernetes</span><span class="sxs-lookup"><span data-stu-id="ce8a1-191">Kubernetes cluster</span></span> | <span data-ttu-id="ce8a1-192">Número de nodos (entre 1 y 50), tamaños de SKU de máquinas virtuales y grupos de nodos (el motor de AKS en Azure Stack Hub solo admite un único grupo de nodos); mediante el comando de escalado del motor de AKS (manual)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-192">Number of Nodes (between 1 and 50), VM-SKU-sizes, and Node Pools (AKS Engine on Azure Stack Hub currently supports only a single node pool); using AKS Engine's scale command (manual)</span></span> |
| <span data-ttu-id="ce8a1-193">Infraestructura</span><span class="sxs-lookup"><span data-stu-id="ce8a1-193">Infrastructure</span></span> | <span data-ttu-id="ce8a1-194">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="ce8a1-194">Azure Stack Hub</span></span> | <span data-ttu-id="ce8a1-195">Número de nodos, capacidad y unidades de escalado en una implementación de Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="ce8a1-195">Number of nodes, capacity, and scale units within an Azure Stack Hub deployment</span></span> |

<span data-ttu-id="ce8a1-196">\* Mediante Horizontal Pod Autoscaler de Kubernetes, mediante el escalado automático basado en métricas o el escalado vertical con ajuste de tamaño de las instancias de contenedor (cpu/memoria).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-196">\* Using Kubernetes' Horizontal Pod Autoscaler (HPA); automated metric-based scaling or vertical scaling by sizing the container instances (cpu/memory).</span></span>

<span data-ttu-id="ce8a1-197">**Azure Stack Hub (nivel de infraestructura)**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-197">**Azure Stack Hub (infrastructure level)**</span></span>

<span data-ttu-id="ce8a1-198">La infraestructura de Azure Stack Hub es la base de esta implementación, ya que Azure Stack Hub se ejecuta en hardware físico de un centro de datos.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-198">The Azure Stack Hub infrastructure is the foundation of this implementation, because Azure Stack Hub runs on physical hardware in a datacenter.</span></span> <span data-ttu-id="ce8a1-199">Al seleccionar el hardware para la instancia de Azure Stack Hub, debe tomar decisiones sobre la CPU, la densidad de memoria, la configuración de almacenamiento y el número de servidores.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-199">When selecting your Hub hardware, you need to make choices for CPU, memory density, storage configuration, and number of servers.</span></span> <span data-ttu-id="ce8a1-200">Para más información sobre la escalabilidad de Azure Stack Hub, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-200">To learn more about Azure Stack Hub's scalability, check out the following resources:</span></span>

- [<span data-ttu-id="ce8a1-201">Introducción al planeamiento de capacidad de Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="ce8a1-201">Capacity planning for Azure Stack Hub overview</span></span>](/azure-stack/operator/azure-stack-capacity-planning-overview)
- [<span data-ttu-id="ce8a1-202">Incorporación de nodos de la unidad de escalado adicionales en Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="ce8a1-202">Add additional scale unit nodes in Azure Stack Hub</span></span>](/azure-stack/operator/azure-stack-add-scale-node)

<span data-ttu-id="ce8a1-203">**Clúster de Kubernetes (nivel de clúster)**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-203">**Kubernetes cluster (cluster level)**</span></span>

<span data-ttu-id="ce8a1-204">El propio clúster de Kubernetes consta de componentes de IaaS de Azure (Stack) y se basa en estos. Entre ellos cabe incluir recursos de proceso, almacenamiento y red.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-204">The Kubernetes cluster itself consists of, and is built on top of Azure (Stack) IaaS components including compute, storage, and network resources.</span></span> <span data-ttu-id="ce8a1-205">Las soluciones de Kubernetes incluyen nodos maestros y de trabajo que se implementan como máquinas virtuales en Azure (y Azure Stack Hub).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-205">Kubernetes solutions involve master and worker nodes, which are deployed as VMs in Azure (and Azure Stack Hub).</span></span>

- <span data-ttu-id="ce8a1-206">Los nodos del [plano de control](/azure/aks/concepts-clusters-workloads#control-plane) (maestro) proporcionan los servicios centrales de Kubernetes y la orquestación de las cargas de trabajo de las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-206">[Control plane nodes](/azure/aks/concepts-clusters-workloads#control-plane) (master) provide the core Kubernetes services and orchestration of application workloads.</span></span>
- <span data-ttu-id="ce8a1-207">Los [nodos de trabajo](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (trabajo) ejecutan las cargas de trabajo de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-207">[Worker nodes](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (worker) run your application workloads.</span></span>

<span data-ttu-id="ce8a1-208">Al seleccionar los tamaños de máquina virtual para la implementación inicial, hay varias consideraciones que se deben tener en cuenta:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-208">When selecting VM sizes for the initial deployment, there are several considerations:</span></span>  

- <span data-ttu-id="ce8a1-209">**Costo**: al planear los nodos de trabajo, tenga en cuenta el costo total por máquina virtual que tendrá.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-209">**Cost** - When planning your worker nodes, keep in mind the overall cost per VM you'll incur.</span></span> <span data-ttu-id="ce8a1-210">Por ejemplo, si las cargas de trabajo de la aplicación requieren recursos limitados, debe planear la implementación de máquinas virtuales de menor tamaño.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-210">For example, if your application workloads require limited resources, you should plan to deploy smaller sized VMs.</span></span> <span data-ttu-id="ce8a1-211">Azure Stack Hub, al igual que Azure, se factura normalmente por consumo, por lo que el ajuste adecuado del tamaño de las máquinas virtuales para los roles de Kubernetes es fundamental para optimizar los costos de consumo.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-211">Azure Stack Hub, like Azure, is normally billed on a consumption basis, so appropriately sizing the VMs for Kubernetes roles is crucial to optimizing consumption costs.</span></span> 

- <span data-ttu-id="ce8a1-212">**Escalabilidad**: la escalabilidad del clúster se consigue mediante el escalado y reducción horizontal del número de nodos maestros y de trabajo, o mediante la adición de grupos de nodos adicionales (no disponibles en Azure Stack Hub actualmente).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-212">**Scalability** - Scalability of the cluster is achieved by scaling in and out the number of master and worker nodes, or by adding additional node pools (not available on Azure Stack Hub today).</span></span> <span data-ttu-id="ce8a1-213">El escalado del clúster se puede realizar según los datos de rendimiento recopilados mediante Container Insights (Azure Monitor + Log Analytics).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-213">Scaling the cluster can be done based on performance data, collected using Container Insights (Azure Monitor + Log Analytics).</span></span> 

    <span data-ttu-id="ce8a1-214">Si su aplicación necesita más (o menos) recursos, puede escalar (o reducir) horizontalmente los nodos actuales (entre 1 y 50 nodos).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-214">If your application needs more (or fewer) resources, you can scale out (or in) your current nodes horizontally (between 1 and 50 nodes).</span></span> <span data-ttu-id="ce8a1-215">Si necesita más de 50 nodos, puede crear un clúster adicional en una suscripción independiente.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-215">If you need more than 50 nodes, you can create an additional cluster in a separate subscription.</span></span> <span data-ttu-id="ce8a1-216">No se pueden escalar verticalmente las máquinas virtuales reales a otro tamaño de máquina virtual sin volver a implementar el clúster.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-216">You can't scale up the actual VMs vertically to another VM size without redeploying the cluster.</span></span>

    <span data-ttu-id="ce8a1-217">El escalado se realiza manualmente con la máquina virtual auxiliar del motor de AKS que se usó para implementar el clúster de Kubernetes inicialmente.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-217">Scaling is done manually using the AKS Engine helper VM that was used to deploy the Kubernetes cluster initially.</span></span> <span data-ttu-id="ce8a1-218">Para más información, consulte [Escalado de clústeres de Kubernetes](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-218">For more information, see [Scaling Kubernetes clusters](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span></span>

- <span data-ttu-id="ce8a1-219">**Cuotas**: tenga en cuenta las [cuotas](/azure-stack/operator/azure-stack-quota-types) que ha configurado al planear una implementación de AKS en la instancia de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-219">**Quotas** - Consider the [quotas](/azure-stack/operator/azure-stack-quota-types) you've configured when planning out an AKS deployment on your Azure Stack Hub.</span></span> <span data-ttu-id="ce8a1-220">Asegúrese de que cada [suscripción](/azure-stack/operator/service-plan-offer-subscription-overview) tenga los planes adecuados y las cuotas configuradas.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-220">Make sure each [subscription](/azure-stack/operator/service-plan-offer-subscription-overview) has the proper plans and the quotas configured.</span></span> <span data-ttu-id="ce8a1-221">La suscripción deberá acomodar la cantidad de proceso, almacenamiento y otros servicios necesarios para los clústeres a medida que estos se escalan horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-221">The subscription will need to accommodate the amount of compute, storage, and other services needed for your clusters as they scale out.</span></span>

- <span data-ttu-id="ce8a1-222">**Cargas de trabajo de aplicaciones**: consulte los [conceptos de clústeres y cargas de trabajo](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) en el documento sobre conceptos básicos de Kubernetes para Azure Kubernetes Service.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-222">**Application workloads** - Refer to the [Clusters and workloads concepts](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) in the Kubernetes core concepts for Azure Kubernetes Service document.</span></span> <span data-ttu-id="ce8a1-223">Este artículo le ayudará a limitar el tamaño adecuado de la máquina virtual en función de las necesidades de proceso y memoria de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-223">This article will help you scope the proper VM size based on the compute and memory needs of your application.</span></span>  

<span data-ttu-id="ce8a1-224">**Aplicación (nivel de aplicación)**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-224">**Application (application level)**</span></span>

<span data-ttu-id="ce8a1-225">En el nivel de aplicación, se usa [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/) de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-225">On the application layer, we use Kubernetes [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span></span> <span data-ttu-id="ce8a1-226">HPA puede aumentar o disminuir el número de réplicas (pods o instancias de contenedor) en nuestra implementación en función de métricas diferentes (como el uso de CPU).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-226">HPA can increase or decrease the number of Replicas (Pod/Container Instances) in our deployment based on different metrics (like CPU utilization).</span></span>

<span data-ttu-id="ce8a1-227">Otra opción consiste en escalar las instancias de contenedor verticalmente.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-227">Another option is to scale container instances vertically.</span></span> <span data-ttu-id="ce8a1-228">Esto se puede lograr cambiando la cantidad de CPU y memoria solicitada y disponible para una implementación específica.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-228">This can be accomplished by changing the amount of CPU and Memory requested and available for a specific deployment.</span></span> <span data-ttu-id="ce8a1-229">Consulte [Administración de recursos de Containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) en kubernetes.io para más información.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-229">See [Managing Resources for Containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) on kubernetes.io to learn more.</span></span>

## <a name="networking-and-connectivity-considerations"></a><span data-ttu-id="ce8a1-230">Aspectos sobre redes y conectividad</span><span class="sxs-lookup"><span data-stu-id="ce8a1-230">Networking and connectivity considerations</span></span>

<span data-ttu-id="ce8a1-231">Las redes y la conectividad también afectan a los tres niveles mencionados anteriormente para Kubernetes en Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-231">Networking and connectivity also affect the three layers mentioned previously for Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="ce8a1-232">En la tabla siguiente se muestran los niveles y los servicios que contienen:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-232">The following table shows the layers and which services they contain:</span></span>

| <span data-ttu-id="ce8a1-233">Nivel</span><span class="sxs-lookup"><span data-stu-id="ce8a1-233">Layer</span></span> | <span data-ttu-id="ce8a1-234">Afecta a</span><span class="sxs-lookup"><span data-stu-id="ce8a1-234">Affects</span></span> | <span data-ttu-id="ce8a1-235">¿Qué?</span><span class="sxs-lookup"><span data-stu-id="ce8a1-235">What?</span></span> |
| --- | --- | ---
| <span data-ttu-id="ce8a1-236">Application</span><span class="sxs-lookup"><span data-stu-id="ce8a1-236">Application</span></span> | <span data-ttu-id="ce8a1-237">Application</span><span class="sxs-lookup"><span data-stu-id="ce8a1-237">Application</span></span> | <span data-ttu-id="ce8a1-238">¿Cómo se puede acceder a la aplicación?</span><span class="sxs-lookup"><span data-stu-id="ce8a1-238">How is the application accessible?</span></span> <span data-ttu-id="ce8a1-239">¿Se expondrá a Internet?</span><span class="sxs-lookup"><span data-stu-id="ce8a1-239">Will it be exposed to the Internet?</span></span> |
| <span data-ttu-id="ce8a1-240">Clúster</span><span class="sxs-lookup"><span data-stu-id="ce8a1-240">Cluster</span></span> | <span data-ttu-id="ce8a1-241">Clúster de Kubernetes</span><span class="sxs-lookup"><span data-stu-id="ce8a1-241">Kubernetes cluster</span></span> | <span data-ttu-id="ce8a1-242">API de Kubernetes, máquina virtual del motor de AKS, extracción de imágenes de contenedor (salida), envío de datos de supervisión y de telemetría (salida)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-242">Kubernetes API, AKS Engine VM, Pulling container images (egress), Sending monitoring data and telemetry (egress)</span></span> |
| <span data-ttu-id="ce8a1-243">Infraestructura</span><span class="sxs-lookup"><span data-stu-id="ce8a1-243">Infrastructure</span></span> | <span data-ttu-id="ce8a1-244">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="ce8a1-244">Azure Stack Hub</span></span> | <span data-ttu-id="ce8a1-245">Accesibilidad de los puntos de conexión de administración de Azure Stack Hub como los del portal y los de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-245">Accessibility of the Azure Stack Hub management endpoints like the portal and Azure Resource Manager endpoints.</span></span> |

<span data-ttu-id="ce8a1-246">**Aplicación**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-246">**Application**</span></span>

<span data-ttu-id="ce8a1-247">En el nivel de la aplicación, el aspecto más importante es si la aplicación está expuesta y es accesible desde Internet.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-247">For the application layer, the most important consideration is whether the application is exposed and accessible from the Internet.</span></span> <span data-ttu-id="ce8a1-248">Desde una perspectiva de Kubernetes, accesibilidad a Internet significa exponer una implementación o pod mediante un servicio de Kubernetes o un controlador de entrada.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-248">From a Kubernetes perspective, Internet accessibility means exposing a deployment or pod using a Kubernetes Service or an Ingress Controller.</span></span>

> [!NOTE]
> <span data-ttu-id="ce8a1-249">Se recomienda el uso de controladores de entrada para exponer los servicios de Kubernetes, ya que el número de direcciones IP públicas de front-end en Azure Stack Hub está limitado a 5.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-249">We recommend the use of Ingress controllers to expose Kubernetes Services as the number of Frontend public IPs on Azure Stack Hub is limited to 5.</span></span> <span data-ttu-id="ce8a1-250">Este diseño también limita el número de servicios de Kubernetes (con el tipo LoadBalancer) a 5, lo cual resultará demasiado pequeño para muchas implementaciones.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-250">This design also limits the number of Kubernetes Services (with the type LoadBalancer) to 5, which will be too small for many deployments.</span></span> <span data-ttu-id="ce8a1-251">Vaya a la [documentación del motor de AKS](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) para más información.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-251">Go to the [AKS Engine documentation](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) to learn more.</span></span>

<span data-ttu-id="ce8a1-252">La exposición de una aplicación mediante una dirección IP pública a través de una instancia de Load Balancer o un controlador de entrada no significa necesariamente que la aplicación sea ahora accesible a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-252">Exposing an application using a public IP via a Load Balancer or an Ingress Controller doesn't nessecarily mean that the application is now accessible via the Internet.</span></span> <span data-ttu-id="ce8a1-253">Es posible que Azure Stack Hub tenga una dirección IP pública que solo sea visible en la Intranet local, no todas las IP públicas son realmente accesibles desde Internet.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-253">It's possible for Azure Stack Hub to have a public IP address that is only visible on the local intranet - not all public IPs are truly Internet-facing.</span></span>

<span data-ttu-id="ce8a1-254">El bloque anterior tiene en cuenta el tráfico de entrada a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-254">The previous block considers ingress traffic to the application.</span></span> <span data-ttu-id="ce8a1-255">Otro tema que debe tenerse en cuenta para una implementación correcta de Kubernetes es el tráfico de salida.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-255">Another topic that must be considered for a successful Kubernetes deployment is outbound/egress traffic.</span></span> <span data-ttu-id="ce8a1-256">Estos son algunos casos de uso que requieren tráfico de salida:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-256">Here are a few use cases that require egress traffic:</span></span>

- <span data-ttu-id="ce8a1-257">Extracción de imágenes de contenedor almacenadas en DockerHub o Azure Container Registry</span><span class="sxs-lookup"><span data-stu-id="ce8a1-257">Pulling Container Images stored on DockerHub or Azure Container Registry</span></span>
- <span data-ttu-id="ce8a1-258">Recuperación de charts de Helm</span><span class="sxs-lookup"><span data-stu-id="ce8a1-258">Retrieving Helm Charts</span></span>
- <span data-ttu-id="ce8a1-259">Emisión de datos de Application Insights (u otros datos de supervisión)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-259">Emitting Application Insights data (or other monitoring data)</span></span>

<span data-ttu-id="ce8a1-260">Algunos entornos empresariales pueden requerir el uso de servidores proxy _transparentes_ o _no transparentes_.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-260">Some enterprise environments might require the use of _transparent_ or _non-transparent_ proxy servers.</span></span> <span data-ttu-id="ce8a1-261">Estos servidores requieren una configuración específica en varios componentes de nuestro clúster.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-261">These servers require specific configuration on various components of our cluster.</span></span> <span data-ttu-id="ce8a1-262">La documentación del motor de AKS contiene varios detalles sobre cómo acomodar los proxies de red.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-262">The AKS Engine documentation contains various details on how to accommodate network proxies.</span></span> <span data-ttu-id="ce8a1-263">Para más información, consulte [Motor de AKS y servidores proxy](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-263">For more details, see [AKS Engine and proxy servers](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span></span>

<span data-ttu-id="ce8a1-264">Por último, el tráfico entre clústeres debe fluir entre las instancias de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-264">Lastly, cross-cluster traffic must flow between Azure Stack Hub instances.</span></span> <span data-ttu-id="ce8a1-265">La implementación de ejemplo consta de clústeres individuales de Kubernetes que se ejecutan en instancias individuales de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-265">The sample deployment consists of individual Kubernetes clusters running on individual Azure Stack Hub instances.</span></span> <span data-ttu-id="ce8a1-266">El tráfico entre ellas, al igual que el tráfico de replicación entre dos bases de datos, es "tráfico externo".</span><span class="sxs-lookup"><span data-stu-id="ce8a1-266">Traffic between them, such as the replication traffic between two databases, is "external traffic".</span></span> <span data-ttu-id="ce8a1-267">El tráfico externo se debe enrutar a través de una VPN de sitio a sitio o de direcciones IP públicas de Azure Stack Hub para conectar Kubernetes en dos instancias de Azure Stack Hub:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-267">External traffic must be routed through either a Site-to-Site VPN or Azure Stack Hub Public IP addresses to connect Kubernetes on two Azure Stack Hub instances:</span></span>

![tráfico entre clústeres y tráfico interno del clúster](media/pattern-highly-available-kubernetes/aks-inter-and-intra-cluster-traffic.png)

<span data-ttu-id="ce8a1-269">**Clúster**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-269">**Cluster**</span></span>  

<span data-ttu-id="ce8a1-270">No es necesario que el clúster de Kubernetes sea accesible a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-270">The Kubernetes cluster doesn't necessarily need to be accessible via the Internet.</span></span> <span data-ttu-id="ce8a1-271">La parte importante es la API de Kubernetes que se usa para trabajar con un clúster, por ejemplo, mediante `kubectl`.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-271">The relevant part is the Kubernetes API used to operate a cluster, for example, using `kubectl`.</span></span> <span data-ttu-id="ce8a1-272">El punto de conexión de la API de Kubernetes debe ser accesible para todos los usuarios que trabajan con el clúster o que implementan aplicaciones y servicios en él.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-272">The Kubernetes API endpoint must be accessible to everyone who operates the cluster or deploys applications and services on top of it.</span></span> <span data-ttu-id="ce8a1-273">Este tema se trata con más detalle desde una perspectiva de DevOps en la sección [Consideraciones de implementación (CI/CD)](#deployment-cicd-considerations) que aparece a continuación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-273">This topic is covered in more detail from a DevOps-perspective in the [Deployment (CI/CD) considerations](#deployment-cicd-considerations) section below.</span></span>

<span data-ttu-id="ce8a1-274">En el nivel de clúster, existen también algunas consideraciones que se deben tener en cuenta sobre el tráfico de salida:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-274">On the cluster level, there are also a few considerations around egress-traffic:</span></span>

- <span data-ttu-id="ce8a1-275">Actualizaciones de nodos (para Ubuntu)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-275">Node updates (for Ubuntu)</span></span>
- <span data-ttu-id="ce8a1-276">Datos de supervisión (que se envían a Azure LogAnalytics)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-276">Monitoring data (sent to Azure LogAnalytics)</span></span>
- <span data-ttu-id="ce8a1-277">Otros agentes que requieren tráfico de salida (específico del entorno de cada implementador)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-277">Other agents requiring outbound traffic (specific to each deployer's environment)</span></span>

<span data-ttu-id="ce8a1-278">Antes de implementar el clúster de Kubernetes mediante el motor de AKS, planee el diseño de red final.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-278">Before you deploy your Kubernetes cluster using AKS Engine, plan for the final networking design.</span></span> <span data-ttu-id="ce8a1-279">En lugar de crear una red virtual dedicada, puede que sea más eficaz implementar un clúster en una red ya existente.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-279">Instead of creating a dedicated Virtual Network, it may be more efficient to deploy a cluster into an existing network.</span></span> <span data-ttu-id="ce8a1-280">Por ejemplo, puede aprovechar una conexión VPN de sitio a sitio existente ya configurada en el entorno de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-280">For example, you might leverage an existing Site-to-Site VPN connection already configured in your Azure Stack Hub environment.</span></span>

<span data-ttu-id="ce8a1-281">**Infraestructura**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-281">**Infrastructure**</span></span>  

<span data-ttu-id="ce8a1-282">La infraestructura hace referencia al acceso a los puntos de conexión de administración de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-282">Infrastructure refers to accessing the Azure Stack Hub management endpoints.</span></span> <span data-ttu-id="ce8a1-283">Los puntos de conexión incluyen los portales de administración y de inquilino, así como los puntos de conexión de administrador y de inquilino de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-283">Endpoints include the tenant and admin portals, and the Azure Resource Manager admin and tenant endpoints.</span></span> <span data-ttu-id="ce8a1-284">Estos puntos de conexión son necesarios para trabajar con Azure Stack Hub y sus servicios principales.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-284">These endpoints are required to operate Azure Stack Hub and its core services.</span></span>

## <a name="data-and-storage-considerations"></a><span data-ttu-id="ce8a1-285">Consideraciones a tener en cuenta sobre datos y almacenamiento</span><span class="sxs-lookup"><span data-stu-id="ce8a1-285">Data and storage considerations</span></span>

<span data-ttu-id="ce8a1-286">Se implementarán dos instancias de la aplicación, en dos clústeres de Kubernetes individuales, en dos instancias de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-286">Two instances of our application will be deployed, on two individual Kubernetes clusters, across two Azure Stack Hub instances.</span></span> <span data-ttu-id="ce8a1-287">En este diseño es necesario tener en cuenta cómo replicar y sincronizar los datos entre ellas.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-287">This design will require us to consider how to replicate and synchronize data between them.</span></span>

<span data-ttu-id="ce8a1-288">Con Azure, disponemos de la funcionalidad integrada para replicar el almacenamiento en varias regiones y zonas dentro de la nube.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-288">With Azure, we have the built-in capability to replicate storage across multiple regions and zones within the cloud.</span></span> <span data-ttu-id="ce8a1-289">Actualmente, con Azure Stack Hub, no hay formas nativas de replicar el almacenamiento en dos instancias diferentes de Azure Stack Hub: forman dos nubes independientes sin ninguna manera de administrarlas como un conjunto.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-289">Currently with Azure Stack Hub there are no native ways to replicate storage across two different Azure Stack Hub instances - they form two independent clouds with no overarching way to manage them as a set.</span></span> <span data-ttu-id="ce8a1-290">La planeación de la resistencia de las aplicaciones que se ejecutan en Azure Stack Hub obliga a tener en cuenta esta independencia en el diseño y las implementaciones de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-290">Planning for resiliency of applications running across Azure Stack Hub forces you to consider this independence in your application design and deployments.</span></span>

<span data-ttu-id="ce8a1-291">En la mayoría de los casos, la replicación del almacenamiento no será necesaria para una aplicación resistente y de alta disponibilidad implementada en AKS.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-291">In most cases, storage replication won't be necessary for a resilient and highly available application deployed on AKS.</span></span> <span data-ttu-id="ce8a1-292">Pero debe tener en cuenta el almacenamiento independiente por instancia de Azure Stack Hub en el diseño de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-292">But you should consider independent storage per Azure Stack Hub instance in your application design.</span></span> <span data-ttu-id="ce8a1-293">Si este diseño es un problema o un obstáculo para implementar la solución en Azure Stack Hub, existen soluciones de asociados que proporcionan soluciones auxiliares de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-293">If this design is a concern or road block to deploying the solution on Azure Stack Hub, there are possible solutions from Microsoft Partners that provide storage attachments.</span></span> <span data-ttu-id="ce8a1-294">Estas ofrecen una solución de replicación de almacenamiento en varias instancias de Azure Stack Hub y Azure.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-294">Storage attachments provide a storage replication solution across multiple Azure Stack Hubs and Azure.</span></span> <span data-ttu-id="ce8a1-295">Para más información, consulte [Soluciones de asociados](#partner-solutions).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-295">For more information, see the [Partner solutions](#partner-solutions).</span></span>

<span data-ttu-id="ce8a1-296">En nuestra arquitectura, se tuvieron en cuenta estos niveles:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-296">In our architecture, these layers were considered:</span></span>

<span data-ttu-id="ce8a1-297">**Configuración**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-297">**Configuration**</span></span>

<span data-ttu-id="ce8a1-298">La configuración incluye la configuración de Azure Stack Hub, el motor de AKS y el propio clúster de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-298">Configuration includes the configuration of Azure Stack Hub, AKS Engine, and the Kubernetes cluster itself.</span></span> <span data-ttu-id="ce8a1-299">La configuración se debe automatizar tanto como sea posible y almacenarse como infraestructura como código en un sistema de control de versiones basado en Git como Azure DevOps o GitHub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-299">The configuration should be automated as much as possible, and stored as Infrastructure-as-Code in a Git-based version control system like Azure DevOps or GitHub.</span></span> <span data-ttu-id="ce8a1-300">Esta configuración no se puede sincronizar fácilmente en varias implementaciones.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-300">These settings cannot easily be synchronized across multiple deployments.</span></span> <span data-ttu-id="ce8a1-301">Por lo tanto, se recomienda almacenar y aplicar la configuración desde fuera y mediante la canalización de DevOps.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-301">Therefore we recommend storing and applying configuration from the outside, and using DevOps pipeline.</span></span>

<span data-ttu-id="ce8a1-302">**Aplicación**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-302">**Application**</span></span>

<span data-ttu-id="ce8a1-303">La aplicación debe almacenarse en un repositorio basado en Git.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-303">The application should be stored in a Git-based repository.</span></span> <span data-ttu-id="ce8a1-304">Siempre que haya una nueva implementación, cambios en la aplicación o recuperación ante desastres, se puede implementar fácilmente mediante Azure Pipelines.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-304">Whenever there's a new deployment, changes to the application, or disaster recovery, it can be easily deployed using Azure Pipelines.</span></span>

<span data-ttu-id="ce8a1-305">**Datos**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-305">**Data**</span></span>

<span data-ttu-id="ce8a1-306">Los datos son el aspecto más importante en la mayoría de los diseños de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-306">Data is the most important consideration in most application designs.</span></span> <span data-ttu-id="ce8a1-307">Los datos de la aplicación deben permanecer sincronizados entre las distintas instancias de esta.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-307">Application data must stay in sync between the different instances of the application.</span></span> <span data-ttu-id="ce8a1-308">Los datos también necesitan una estrategia de copia de seguridad y recuperación ante desastres en caso de que se produzca una interrupción.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-308">Data also needs a backup and disaster recovery strategy if there's an outage.</span></span>

<span data-ttu-id="ce8a1-309">Lograr este diseño depende en gran medida de las opciones de tecnología.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-309">Achieving this design depends heavily on technology choices.</span></span> <span data-ttu-id="ce8a1-310">Estos son algunos ejemplos de soluciones para implementar una base de datos con alta disponibilidad en Azure Stack Hub:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-310">Here are some solution examples for implementing a database in a highly available fashion on Azure Stack Hub:</span></span>

- [<span data-ttu-id="ce8a1-311">Implementar un grupo de disponibilidad de SQL Server 2016 en Azure y Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="ce8a1-311">Deploy a SQL Server 2016 availability group to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-sql-ha)
- [<span data-ttu-id="ce8a1-312">Implementar una solución MongoDB de alta disponibilidad en Azure y Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="ce8a1-312">Deploy a highly available MongoDB solution to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-mongodb-ha)

<span data-ttu-id="ce8a1-313">Las consideraciones que se deben tener en cuenta al trabajar con datos en varias ubicaciones es un aspecto aún más complejo a la hora de conseguir una solución resistente y de alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-313">Considerations when working with data across multiple locations is an even more complex consideration for a highly available and resilient solution.</span></span> <span data-ttu-id="ce8a1-314">Tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-314">Consider:</span></span>

- <span data-ttu-id="ce8a1-315">Latencia y conectividad de red entre instancias de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-315">Latency and network connectivity between Azure Stack Hubs.</span></span>
- <span data-ttu-id="ce8a1-316">Disponibilidad de identidades para los servicios y permisos.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-316">Availability of identities for services and permissions.</span></span> <span data-ttu-id="ce8a1-317">Cada instancia de Azure Stack Hub se integra con un directorio externo.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-317">Each Azure Stack Hub instance integrates with an external directory.</span></span> <span data-ttu-id="ce8a1-318">Durante la implementación puede elegir entre usar Azure Active Directory (Azure AD) o los Servicios de federación de Active Directory (AD FS).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-318">During deployment, you choose to use either Azure Active Directory (Azure AD) or Active Directory Federation Services (ADFS).</span></span> <span data-ttu-id="ce8a1-319">Como tal, existe la posibilidad de usar una única identidad que pueda interactuar con varias instancias independientes de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-319">As such, there's potential to use a single identity that can interact with multiple independent Azure Stack Hub instances.</span></span>

## <a name="business-continuity-and-disaster-recovery"></a><span data-ttu-id="ce8a1-320">Continuidad empresarial y recuperación ante desastres</span><span class="sxs-lookup"><span data-stu-id="ce8a1-320">Business continuity and disaster recovery</span></span>

<span data-ttu-id="ce8a1-321">La continuidad empresarial y la recuperación ante desastres (BCDR) son un tema importante en Azure Stack Hub y en Azure.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-321">Business continuity and disaster recovery (BCDR) is an important topic in both Azure Stack Hub and Azure.</span></span> <span data-ttu-id="ce8a1-322">La diferencia principal es que en Azure Stack Hub, el operador debe administrar todo el proceso de BCDR.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-322">The main difference is that in Azure Stack Hub, the operator must manage the whole BCDR process.</span></span> <span data-ttu-id="ce8a1-323">En Azure, determinadas partes de BCDR se administran automáticamente mediante Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-323">In Azure, parts of BCDR are automatically managed by Microsoft.</span></span>

<span data-ttu-id="ce8a1-324">La continuidad empresarial y recuperación ante desastres afecta a las mismas áreas mencionadas en la sección anterior [Consideraciones a tener en cuenta sobre datos y almacenamiento](#data-and-storage-considerations):</span><span class="sxs-lookup"><span data-stu-id="ce8a1-324">BCDR affects the same areas mentioned in the previous section [Data and storage considerations](#data-and-storage-considerations):</span></span>

- <span data-ttu-id="ce8a1-325">Infraestructura y configuración</span><span class="sxs-lookup"><span data-stu-id="ce8a1-325">Infrastructure / Configuration</span></span>
- <span data-ttu-id="ce8a1-326">Disponibilidad de la aplicación</span><span class="sxs-lookup"><span data-stu-id="ce8a1-326">Application Availability</span></span>
- <span data-ttu-id="ce8a1-327">Datos de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="ce8a1-327">Application Data</span></span>

<span data-ttu-id="ce8a1-328">Y como se mencionó en la sección anterior, estas áreas son responsabilidad del operador de Azure Stack Hub y pueden variar entre organizaciones.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-328">And as mentioned in the previous section, these areas are the responsibility of the Azure Stack Hub operator and can vary between organizations.</span></span> <span data-ttu-id="ce8a1-329">Planee el BCDR según las herramientas y procesos disponibles.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-329">Plan BCDR according to your available tools and processes.</span></span>

<span data-ttu-id="ce8a1-330">**Infraestructura y configuración**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-330">**Infrastructure and configuration**</span></span>

<span data-ttu-id="ce8a1-331">En esta sección se describe la infraestructura física y lógica y la configuración de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-331">This section covers the physical and logical infrastructure and the configuration of Azure Stack Hub.</span></span> <span data-ttu-id="ce8a1-332">Incluye las acciones en los espacios de administración y de inquilino.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-332">It covers actions in the admin and the tenant spaces.</span></span>

<span data-ttu-id="ce8a1-333">El operador de Azure Stack Hub (o administrador) es responsable del mantenimiento de las instancias de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-333">The Azure Stack Hub operator (or administrator) is responsible for maintenance of the Azure Stack Hub instances.</span></span> <span data-ttu-id="ce8a1-334">Incluye componentes como la red, el almacenamiento, la identidad y otros temas que se encuentran fuera del ámbito de este artículo.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-334">Including components such as the network, storage, identity, and other topics that are outside the scope of this article.</span></span> <span data-ttu-id="ce8a1-335">Para más información sobre los detalles de las operaciones de Azure Stack Hub, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-335">To learn more about the specifics of Azure Stack Hub operations, see the following resources:</span></span>

- [<span data-ttu-id="ce8a1-336">Recuperación de datos de Azure Stack Hub con el servicio Copia de seguridad de infraestructura</span><span class="sxs-lookup"><span data-stu-id="ce8a1-336">Recover data in Azure Stack Hub with the Infrastructure Backup Service</span></span>](/azure-stack/operator/azure-stack-backup-infrastructure-backup)
- [<span data-ttu-id="ce8a1-337">Habilitación de la copia de seguridad de Azure Stack Hub desde el portal del administrador</span><span class="sxs-lookup"><span data-stu-id="ce8a1-337">Enable backup for Azure Stack Hub from the administrator portal</span></span>](/azure-stack/operator/azure-stack-backup-enable-backup-console)
- [<span data-ttu-id="ce8a1-338">Recuperación después de una pérdida de datos grave</span><span class="sxs-lookup"><span data-stu-id="ce8a1-338">Recover from catastrophic data loss</span></span>](/azure-stack/operator/azure-stack-backup-recover-data)
- [<span data-ttu-id="ce8a1-339">Procedimientos recomendados del servicio Infrastructure Backup</span><span class="sxs-lookup"><span data-stu-id="ce8a1-339">Infrastructure Backup Service best practices</span></span>](/azure-stack/operator/azure-stack-backup-best-practices)

<span data-ttu-id="ce8a1-340">Azure Stack Hub es la plataforma y el tejido sobre los que se implementarán las aplicaciones de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-340">Azure Stack Hub is the platform and fabric on which Kubernetes applications will be deployed.</span></span> <span data-ttu-id="ce8a1-341">El propietario de la aplicación de Kubernetes será un usuario de Azure Stack Hub, con acceso otorgado para implementar la infraestructura de la aplicación necesaria para la solución.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-341">The application owner for the Kubernetes application will be a user of Azure Stack Hub, with access granted to deploy the application infrastructure needed for the solution.</span></span> <span data-ttu-id="ce8a1-342">En este caso, la infraestructura de la aplicación significa el clúster de Kubernetes, que se implementa mediante el motor de AKS, y los servicios circundantes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-342">Application infrastructure in this case means the Kubernetes cluster, deployed using AKS Engine, and the surrounding services.</span></span> <span data-ttu-id="ce8a1-343">Estos componentes se implementarán en Azure Stack Hub, restringidos mediante una oferta de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-343">These components will be deployed into Azure Stack Hub, constrained by an Azure Stack Hub offer.</span></span> <span data-ttu-id="ce8a1-344">Asegúrese de que la oferta aceptada por el propietario de la aplicación de Kubernetes tenga capacidad suficiente (expresada en cuotas de Azure Stack Hub) para implementar toda la solución.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-344">Make sure the offer accepted by the Kubernetes application owner has sufficient capacity (expressed in Azure Stack Hub quotas) to deploy the entire solution.</span></span> <span data-ttu-id="ce8a1-345">Tal como se recomienda en la sección anterior, la implementación de la aplicación se debe automatizar mediante canalizaciones de infraestructura como código y de implementación como Azure Pipelines para Azure DevOps.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-345">As recommended in the previous section, the application deployment should be automated using Infrastructure-as-Code and deployment pipelines like Azure DevOps Azure Pipelines.</span></span>

<span data-ttu-id="ce8a1-346">Para más información sobre las ofertas y cuotas de Azure Stack Hub, consulte [Introducción a los servicios, planes, ofertas y suscripciones de Azure Stack Hub](/azure-stack/operator/service-plan-offer-subscription-overview).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-346">For more information on Azure Stack Hub offers and quotas, see [Azure Stack Hub services, plans, offers, and subscriptions overview](/azure-stack/operator/service-plan-offer-subscription-overview)</span></span>

<span data-ttu-id="ce8a1-347">Es importante guardar y almacenar de forma segura la configuración del motor de AKS, incluidas sus salidas.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-347">It's important to securely save and store the AKS Engine configuration including its outputs.</span></span> <span data-ttu-id="ce8a1-348">Estos archivos contienen información confidencial que se usa para acceder al clúster de Kubernetes, por lo que debe protegerse para impedir que se exponga a usuarios que no son administradores.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-348">These files contain confidential information used to access the Kubernetes cluster, so it must be protected from being exposed to non-administrators.</span></span>

<span data-ttu-id="ce8a1-349">**Disponibilidad de la aplicación**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-349">**Application availability**</span></span>

<span data-ttu-id="ce8a1-350">La aplicación no debe basarse en las copias de seguridad de una instancia implementada.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-350">The application shouldn't rely on backups of a deployed instance.</span></span> <span data-ttu-id="ce8a1-351">Como procedimiento estándar, vuelva a implementar la aplicación por completo siguiendo los patrones de infraestructura como código.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-351">As a standard practice, redeploy the application completely following Infrastructure-as-Code patterns.</span></span> <span data-ttu-id="ce8a1-352">Por ejemplo, vuelva a implementar con Azure Pipelines para Azure DevOps.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-352">For example, redeploy using Azure DevOps Azure Pipelines.</span></span> <span data-ttu-id="ce8a1-353">El procedimiento de continuidad empresarial y recuperación ante desastres debe incluir la reimplementación de la aplicación en el mismo clúster de Kubernetes o en otro diferente.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-353">The BCDR procedure should involve the redeployment of the application to the same or another Kubernetes cluster.</span></span>

<span data-ttu-id="ce8a1-354">**Datos de la aplicación**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-354">**Application data**</span></span>

<span data-ttu-id="ce8a1-355">Los datos de la aplicación constituyen el componente fundamental para minimizar la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-355">Application data is the critical part to minimize data loss.</span></span> <span data-ttu-id="ce8a1-356">En la sección anterior, se describen las técnicas para replicar y sincronizar datos entre dos o más instancias de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-356">In the previous section, techniques to replicate and synchronize data between two (or more) instances of the application were described.</span></span> <span data-ttu-id="ce8a1-357">En función de la infraestructura de la base de datos (MySQL, MongoDB, MSSQL u otras) que se use para almacenar los datos, habrá diferentes técnicas de disponibilidad y copia de seguridad de base de datos disponibles para elegir.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-357">Depending on the database infrastructure (MySQL, MongoDB, MSSQL or others) used to store the data, there will be different database availability and backup techniques available to choose from.</span></span>

<span data-ttu-id="ce8a1-358">Las maneras recomendadas para lograr la integridad incluyen el uso de:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-358">The recommended ways to achieve integrity are to use either:</span></span>
- <span data-ttu-id="ce8a1-359">Una solución de copia de seguridad nativa para la base de datos específica.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-359">A native backup solution for the specific database.</span></span>
- <span data-ttu-id="ce8a1-360">Una solución de copia de seguridad que admite oficialmente la copia de seguridad y la recuperación del tipo de base de datos que emplea la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-360">A backup solution that officially supports backup and recovery of the database type used by your application.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ce8a1-361">No almacene los datos de copia de seguridad en la misma instancia de Azure Stack Hub en la que residen los datos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-361">Do not store your backup data on the same Azure Stack Hub instance where your application data resides.</span></span> <span data-ttu-id="ce8a1-362">Una interrupción completa de la instancia de Azure Stack Hub también pondría en peligro las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-362">A complete outage of the Azure Stack Hub instance would also compromise your backups.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="ce8a1-363">Consideraciones sobre disponibilidad</span><span class="sxs-lookup"><span data-stu-id="ce8a1-363">Availability considerations</span></span>

<span data-ttu-id="ce8a1-364">La implementación de Kubernetes en Azure Stack Hub mediante el motor de AKS no es un servicio administrado.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-364">Kubernetes on Azure Stack Hub deployed via AKS Engine isn't a managed service.</span></span> <span data-ttu-id="ce8a1-365">Se trata de la implementación y configuración automatizadas de un clúster de Kubernetes mediante la infraestructura como servicio de Azure.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-365">It's an automated deployment and configuration of a Kubernetes cluster using Azure Infrastructure-as-a-Service (IaaS).</span></span> <span data-ttu-id="ce8a1-366">Como tal, proporciona la misma disponibilidad que la infraestructura subyacente.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-366">As such, it provides the same availability as the underlying infrastructure.</span></span>

<span data-ttu-id="ce8a1-367">La infraestructura de Azure Stack Hub ya es resistente a los errores y proporciona funcionalidades, como los conjuntos de disponibilidad, para distribuir los componentes entre varios [dominios de error y de actualización](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-367">Azure Stack Hub infrastructure is already resilient to failures, and provides capabilities like Availability Sets to distribute components across multiple [fault and update domains](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span></span> <span data-ttu-id="ce8a1-368">No obstante, la tecnología subyacente (clústeres de conmutación por error) puede experimentar un cierto tiempo de inactividad de las máquinas virtuales de un servidor físico si se produce un error de hardware.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-368">But the underlying technology (failover clustering) still incurs some downtime for VMs on an impacted physical server, if there's a hardware failure.</span></span>

<span data-ttu-id="ce8a1-369">Es recomendable implementar el clúster de Kubernetes de producción, así como la carga de trabajo, en dos (o más) clústeres.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-369">It's a good practice to deploy your production Kubernetes cluster as well as the workload to two (or more) clusters.</span></span> <span data-ttu-id="ce8a1-370">Estos clústeres se deben hospedar en diferentes ubicaciones o centros de datos y usar tecnologías como Azure Traffic Manager para enrutar a los usuarios en función del tiempo de respuesta del clúster o según la geografía.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-370">These clusters should be hosted in different locations or datacenters, and use technologies like Azure Traffic Manager to route users based on cluster response time or based on geography.</span></span>

![Uso de Traffic Manager para controlar los flujos de tráfico](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager.png)

<span data-ttu-id="ce8a1-372">Los clientes que tienen un único clúster de Kubernetes suelen conectarse a la dirección IP de servicio o al nombre DNS de una aplicación determinada.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-372">Customers who have a single Kubernetes cluster typically connect to the service IP or DNS name of a given application.</span></span> <span data-ttu-id="ce8a1-373">En una implementación de varios clústeres, los clientes deben conectarse a un nombre DNS de Traffic Manager que apunte a los servicios o entradas en cada clúster de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-373">In a multi-cluster deployment, customers should connect to a Traffic Manager DNS name that points to the services/ingress on each Kubernetes cluster.</span></span>

![Uso de Traffic Manager para enrutar a un clúster local](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager-on-premises.png)

> [!NOTE]
> <span data-ttu-id="ce8a1-375">Este patrón también es un [procedimiento recomendado para clústeres de AKS (administrados) en Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-375">This pattern is also a [best practice for (managed) AKS clusters in Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span></span>

<span data-ttu-id="ce8a1-376">El propio clúster de Kubernetes, implementado mediante el motor de AKS, debe constar de al menos tres nodos maestros y dos nodos de trabajo.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-376">The Kubernetes cluster itself, deployed via AKS Engine, should consist of at least three master nodes and two worker nodes.</span></span>

## <a name="identity-and-security-considerations"></a><span data-ttu-id="ce8a1-377">Consideraciones que debe tener en cuenta sobre identidad y seguridad</span><span class="sxs-lookup"><span data-stu-id="ce8a1-377">Identity and security considerations</span></span>

<span data-ttu-id="ce8a1-378">La identidad y la seguridad son temas importantes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-378">Identity and security are important topics.</span></span> <span data-ttu-id="ce8a1-379">Especialmente si la solución abarca instancias de Azure Stack Hub independientes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-379">Especially when the solution spans independent Azure Stack Hub instances.</span></span> <span data-ttu-id="ce8a1-380">Kubernetes y Azure (incluido Azure Stack Hub) tienen diferentes mecanismos de control de acceso basado en rol (RBAC):</span><span class="sxs-lookup"><span data-stu-id="ce8a1-380">Kubernetes and Azure (including Azure Stack Hub) both have distinct mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="ce8a1-381">El control de acceso basado en rol de Azure controla el acceso a los recursos de Azure (y de Azure Stack Hub), incluida la capacidad de crear nuevos recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-381">Azure RBAC controls access to resources in Azure (and Azure Stack Hub), including the ability to create new Azure resources.</span></span> <span data-ttu-id="ce8a1-382">Los permisos se pueden asignar a usuarios, grupos o entidades de servicio.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-382">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="ce8a1-383">(Una entidad de servicio es una identidad de seguridad utilizada por las aplicaciones).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-383">(A service principal is a security identity used by applications.)</span></span>
- <span data-ttu-id="ce8a1-384">El control de acceso basado en rol de Kubernetes controla los permisos para la API de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-384">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="ce8a1-385">Por ejemplo, la creación de pods y la enumeración de pods son acciones que se pueden autorizar (o denegar) a un usuario mediante RBAC.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-385">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="ce8a1-386">Para asignar permisos de Kubernetes a los usuarios, puede crear roles y enlaces de rol.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-386">To assign Kubernetes permissions to users, you create roles and role bindings.</span></span>

<span data-ttu-id="ce8a1-387">**Identidad y control de acceso basado en rol de Azure Stack Hub**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-387">**Azure Stack Hub identity and RBAC**</span></span>

<span data-ttu-id="ce8a1-388">Azure Stack Hub proporciona dos opciones de proveedor de identidades.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-388">Azure Stack Hub provides two identity provider choices.</span></span> <span data-ttu-id="ce8a1-389">El proveedor que use dependerá del entorno y de si se ejecuta en un entorno con o sin conexión:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-389">The provider you use depends on the environment and whether running in a connected or disconnected environment:</span></span>

- <span data-ttu-id="ce8a1-390">Azure AD: solo se puede usar en un entorno conectado.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-390">Azure AD - can only be used in a connected environment.</span></span>
- <span data-ttu-id="ce8a1-391">ADFS en un bosque de Active Directory tradicional: puede usarse en un entorno con o sin conexión.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-391">ADFS to a traditional Active Directory forest - can be used in both a connected or disconnected environment.</span></span>

<span data-ttu-id="ce8a1-392">El proveedor de identidades administra usuarios y grupos, incluida la autenticación y autorización para acceder a los recursos.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-392">The identity provider manages users and groups, including authentication and authorization for accessing resources.</span></span> <span data-ttu-id="ce8a1-393">Se puede conceder acceso a los recursos de Azure Stack Hub como suscripciones y grupos de recursos, y a recursos individuales, como las máquinas virtuales o los equilibradores de carga.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-393">Access can be granted to Azure Stack Hub resources like subscriptions, resource groups, and individual resources like VMs or load balancers.</span></span> <span data-ttu-id="ce8a1-394">Para tener un modelo de acceso coherente, considere la posibilidad de usar los mismos grupos (directos o anidados) para todas las instancias de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-394">To have a consistent access model, you should consider using the same groups (either direct or nested) for all Azure Stack Hubs.</span></span> <span data-ttu-id="ce8a1-395">A continuación se muestra un ejemplo de configuración:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-395">Here's a configuration example:</span></span>

![grupos de AAD anidados con Azure Stack Hub](media/pattern-highly-available-kubernetes/azure-stack-azure-ad-nested-groups.png)

<span data-ttu-id="ce8a1-397">El ejemplo contiene un grupo dedicado (con AAD o ADFS) para un propósito específico.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-397">The example contains a dedicated group (using AAD or ADFS) for a specific purpose.</span></span> <span data-ttu-id="ce8a1-398">Por ejemplo, para proporcionar permisos de Colaborador para el grupo de recursos que contiene nuestra infraestructura de clústeres de Kubernetes en una instancia de Azure Stack Hub específica (en este ejemplo "Colaborador del clúster Seattle K8s").</span><span class="sxs-lookup"><span data-stu-id="ce8a1-398">For example, to provide Contributor permissions for the Resource Group that contains our Kubernetes cluster infrastructure on a specific Azure Stack Hub instance (here "Seattle K8s Cluster Contributor").</span></span> <span data-ttu-id="ce8a1-399">A continuación, estos grupos se anidan en un grupo global que contiene los "subgrupos" de cada instancia de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-399">These groups are then nested into an overall group that contains the "subgroups" for each Azure Stack Hub.</span></span>

<span data-ttu-id="ce8a1-400">Nuestro usuario de ejemplo tendrá ahora permisos de "Colaborador" en los grupos de recursos que contengan todo el conjunto de recursos de infraestructura de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-400">Our sample user will now have "Contributor" permissions to both Resources Groups that contain the entire set of Kubernetes infrastructure resources.</span></span> <span data-ttu-id="ce8a1-401">El usuario tendrá acceso a los recursos de ambas instancias de Azure Stack Hub, ya que estas comparten el mismo proveedor de identidades.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-401">The user will have access to resources on both Azure Stack Hub instances, because the instances share the same identity provider.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ce8a1-402">Estos permisos solo afectan a Azure Stack Hub y a algunos de los recursos implementados en él.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-402">These permissions affect only Azure Stack Hub and some of the resources deployed on top of it.</span></span> <span data-ttu-id="ce8a1-403">Un usuario que tenga este nivel de acceso puede causar muchos daños, pero no puede acceder a las máquinas virtuales de IaaS de Kubernetes ni a la API de Kubernetes sin acceso adicional a la implementación de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-403">A user who has this level of access can do a lot of harm, but cannot access the Kubernetes IaaS VMs nor the Kubernetes API without additional access to the Kubernetes deployment.</span></span>

<span data-ttu-id="ce8a1-404">**Identidad de Kubernetes y RBAC**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-404">**Kubernetes identity and RBAC**</span></span>

<span data-ttu-id="ce8a1-405">De forma predeterminada, un clúster de Kubernetes no usa el mismo proveedor de identidades que la instancia de Azure Stack Hub subyacente.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-405">A Kubernetes cluster, by default, doesn't use the same Identity Provider as the underlaying Azure Stack Hub.</span></span> <span data-ttu-id="ce8a1-406">Las máquinas virtuales que hospedan el clúster de Kubernetes, el maestro y los nodos de trabajo usan la clave SSH que se especifica durante la implementación del clúster.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-406">The VMs hosting the Kubernetes cluster, the master, and worker nodes, use the SSH Key that is specified during the deployment of the cluster.</span></span> <span data-ttu-id="ce8a1-407">Esta clave SSH es necesaria para conectarse a estos nodos mediante SSH.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-407">This SSH key is required to connect to these nodes using SSH.</span></span>

<span data-ttu-id="ce8a1-408">La API de Kubernetes (por ejemplo, a la que se tiene acceso mediante `kubectl`) también está protegida por las cuentas de servicio, incluida una cuenta de servicio "Administrador de clústeres" predeterminada.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-408">The Kubernetes API (for example, accessed by using `kubectl`) is also protected by service accounts including a default "cluster admin" service account.</span></span> <span data-ttu-id="ce8a1-409">Las credenciales de esta cuenta de servicio se almacenan inicialmente en el archivo `.kube/config` de los nodos maestro de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-409">The credentials for this service account are initially stored in the `.kube/config` file on your Kubernetes master nodes.</span></span>

<span data-ttu-id="ce8a1-410">**Administración de secretos y credenciales de aplicaciones**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-410">**Secrets management and application credentials**</span></span>

<span data-ttu-id="ce8a1-411">Para almacenar secretos como cadenas de conexión o credenciales de base de datos, hay varias opciones, entre las que se incluyen:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-411">To store secrets like connection strings or database credentials there are several choices, including:</span></span>

- <span data-ttu-id="ce8a1-412">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="ce8a1-412">Azure Key Vault</span></span>
- <span data-ttu-id="ce8a1-413">Secretos de Kubernetes</span><span class="sxs-lookup"><span data-stu-id="ce8a1-413">Kubernetes Secrets</span></span>
- <span data-ttu-id="ce8a1-414">Soluciones de terceros como HashiCorp Vault (que se ejecuta en Kubernetes)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-414">3rd-Party solutions like HashiCorp Vault (running on Kubernetes)</span></span>

<span data-ttu-id="ce8a1-415">No almacene secretos o credenciales en texto no cifrado en los archivos de configuración, en el código de la aplicación ni en los scripts.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-415">Do not store secrets or credentials in plaintext in your configuration files, application code, or within scripts.</span></span> <span data-ttu-id="ce8a1-416">Y no los almacene en un sistema de control de versiones.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-416">And do not store them in a version control system.</span></span> <span data-ttu-id="ce8a1-417">En su lugar, la automatización de la implementación debe recuperar los secretos según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-417">Instead, the deployment automation should retrieve the secrets as needed.</span></span>

## <a name="patch-and-update"></a><span data-ttu-id="ce8a1-418">Revisiones y actualizaciones</span><span class="sxs-lookup"><span data-stu-id="ce8a1-418">Patch and update</span></span>

<span data-ttu-id="ce8a1-419">El proceso de **revisión y actualización (PNU)** de Azure Kubernetes Service está parcialmente automatizado.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-419">The **Patch and Update (PNU)** process in Azure Kubernetes Service is partially automated.</span></span> <span data-ttu-id="ce8a1-420">Las actualizaciones de versiones de Kubernetes se desencadenan manualmente, mientras que las actualizaciones de seguridad se aplican automáticamente.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-420">Kubernetes version upgrades are triggered manually, while security updates are applied automatically.</span></span> <span data-ttu-id="ce8a1-421">Estas actualizaciones pueden incluir las revisiones de seguridad del sistema operativo o las actualizaciones del kernel.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-421">These updates can include OS security fixes or kernel updates.</span></span> <span data-ttu-id="ce8a1-422">AKS no reinicia automáticamente estos nodos de Linux para completar el proceso de actualización.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-422">AKS doesn't automatically reboot these Linux nodes to complete the update process.</span></span> 

<span data-ttu-id="ce8a1-423">El proceso de revisión y actualización de un clúster de Kubernetes implementado con el motor de AKS en Azure Stack Hub no está administrado y es responsabilidad del operador de clústeres.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-423">The PNU process for a Kubernetes cluster deployed using AKS Engine on Azure Stack Hub is unmanaged, and is the responsibility of the cluster operator.</span></span> 

<span data-ttu-id="ce8a1-424">El motor de AKS ayuda con las dos tareas más importantes:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-424">AKS Engine helps with the two most important tasks:</span></span>

- [<span data-ttu-id="ce8a1-425">Actualizar a una versión más reciente de la imagen de Kubernetes y del sistema operativo base</span><span class="sxs-lookup"><span data-stu-id="ce8a1-425">Upgrade to a newer Kubernetes and base OS image version</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-upgrade-to-a-newer-kubernetes-version)
- [<span data-ttu-id="ce8a1-426">Actualizar solo la imagen del sistema operativo base</span><span class="sxs-lookup"><span data-stu-id="ce8a1-426">Upgrade the base OS image only</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-only-upgrade-the-os-image)

<span data-ttu-id="ce8a1-427">Las imágenes más recientes del sistema operativo base contienen las últimas correcciones de seguridad del sistema operativo y las actualizaciones del kernel.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-427">Newer base OS images contain the latest OS security fixes and kernel updates.</span></span> 

<span data-ttu-id="ce8a1-428">El mecanismo de [actualización desatendida](https://wiki.debian.org/UnattendedUpgrades) instala automáticamente las actualizaciones de seguridad que se publican antes de que haya disponible una nueva versión de la imagen del sistema operativo base en el Marketplace de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-428">The [Unattended Upgrade](https://wiki.debian.org/UnattendedUpgrades) mechanism automatically installs security updates that are released before a new base OS image version is available in the Azure Stack Hub Marketplace.</span></span> <span data-ttu-id="ce8a1-429">La actualización desatendida está habilitada de forma predeterminada e instala las actualizaciones de seguridad automáticamente, pero no reinicia los nodos de clúster de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-429">Unattended upgrade is enabled by default and installs security updates automatically, but does not reboot the Kubernetes cluster nodes.</span></span> <span data-ttu-id="ce8a1-430">El reinicio de los nodos puede automatizarse mediante el código abierto [**K** Ubernetes **RE** boot **D** aemon (Kured))](/azure/aks/node-updates-kured).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-430">Rebooting the nodes can be automated using the open-source [**K** Ubernetes **RE** boot **D** aemon (kured))](/azure/aks/node-updates-kured).</span></span> <span data-ttu-id="ce8a1-431">Kured supervisa los nodos de Linux que requieren un reinicio y, después, administra automáticamente la reprogramación de los pods en ejecución y el proceso de reinicio de los nodos.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-431">Kured watches for Linux nodes that require a reboot, then automatically handle the rescheduling of running pods and node reboot process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="ce8a1-432">Consideraciones de implementación (CI/CD)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-432">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="ce8a1-433">Azure y Azure Stack Hub exponen las mismas API REST de Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-433">Azure and Azure Stack Hub expose the same Azure Resource Manager REST APIs.</span></span> <span data-ttu-id="ce8a1-434">Estas API se tratan como cualquier otra nube de Azure (Azure, Azure China 21Vianet, Azure Government).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-434">These APIs are addressed like any other Azure cloud (Azure, Azure China 21Vianet, Azure Government).</span></span> <span data-ttu-id="ce8a1-435">Puede haber diferencias en las versiones de API entre las nubes, y Azure Stack Hub proporciona solo un subconjunto de servicios.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-435">There may be differences in API versions between clouds, and Azure Stack Hub provides only a subset of services.</span></span> <span data-ttu-id="ce8a1-436">El URI del punto de conexión de administración también es diferente para cada nube y cada instancia de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-436">The management endpoint URI is also different for each cloud, and each instance of Azure Stack Hub.</span></span>

<span data-ttu-id="ce8a1-437">Aparte de las pequeñas diferencias ya mencionadas, las API REST de Azure Resource Manager proporcionan una manera coherente de interactuar con Azure y Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-437">Aside from the subtle differences mentioned, Azure Resource Manager REST APIs provide a consistent way to interact with both Azure and Azure Stack Hub.</span></span> <span data-ttu-id="ce8a1-438">Aquí se puede usar el mismo conjunto de herramientas que se utilizará con cualquier otra nube de Azure.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-438">The same set of tools can be used here as would be used with any other Azure cloud.</span></span> <span data-ttu-id="ce8a1-439">Puede usar Azure DevOps, herramientas como Jenkins, o PowerShell para implementar y coordinar servicios en Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-439">You can use Azure DevOps, tools like Jenkins, or PowerShell, to deploy and orchestrate services to Azure Stack Hub.</span></span>

<span data-ttu-id="ce8a1-440">**Consideraciones**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-440">**Considerations**</span></span>

<span data-ttu-id="ce8a1-441">Una de las principales diferencias en lo que respecta a las implementaciones de Azure Stack Hub es la cuestión de la accesibilidad a Internet.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-441">One of the major differences when it comes to Azure Stack Hub deployments is the question of Internet accessibility.</span></span> <span data-ttu-id="ce8a1-442">La accesibilidad a Internet determina si se debe seleccionar un agente de compilación hospedado por Microsoft o uno autohospedado para los trabajos de CI/CD.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-442">Internet accessibility determines whether to select a Microsoft-hosted or a self-hosted build agent for your CI/CD jobs.</span></span>

<span data-ttu-id="ce8a1-443">Un agente autohospedado se puede ejecutar sobre Azure Stack Hub (como una máquina virtual de IaaS) o en una subred con acceso a Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-443">A self-hosted agent can run on top of Azure Stack Hub (as an IaaS VM) or in a network subnet that can access Azure Stack Hub.</span></span> <span data-ttu-id="ce8a1-444">Vaya a [Agentes de Azure Pipelines](/azure/devops/pipelines/agents/agents) para más información sobre las diferencias.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-444">Go to [Azure Pipelines agents](/azure/devops/pipelines/agents/agents) to learn more about the differences.</span></span>

<span data-ttu-id="ce8a1-445">La siguiente imagen le ayuda a decidir si necesita un agente de compilación autohospedado o uno hospedado por Microsoft:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-445">The following image helps you to decide if you need a self-hosted or a Microsoft-hosted build agent:</span></span>

![Ventajas e inconvenientes de los agentes de compilación autohospedados](media/pattern-highly-available-kubernetes/aks-on-stack-self-hosted-build-agents-yes-or-no.png)

- <span data-ttu-id="ce8a1-447">¿Son los puntos de conexión de administración de Azure Stack Hub accesibles a través de Internet?</span><span class="sxs-lookup"><span data-stu-id="ce8a1-447">Are the Azure Stack Hub management endpoints accessible via Internet?</span></span>
  - <span data-ttu-id="ce8a1-448">Sí: se puede usar Azure Pipelines con agentes hospedados por Microsoft para conectarse a Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-448">Yes: We can use Azure Pipelines with Microsoft-hosted agents to connect to Azure Stack Hub.</span></span>
  - <span data-ttu-id="ce8a1-449">No: se necesitan agentes autohospedados que puedan conectarse a los puntos de conexión de administración de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-449">No: We need self-hosted agents that can connect to Azure Stack Hub's management endpoints.</span></span>
- <span data-ttu-id="ce8a1-450">¿Es el clúster de Kubernetes accesible a través de Internet?</span><span class="sxs-lookup"><span data-stu-id="ce8a1-450">Is our Kubernetes cluster accessible via the Internet?</span></span>
  - <span data-ttu-id="ce8a1-451">Sí: se puede usar Azure Pipelines con agentes hospedados por Microsoft para interactuar directamente con el punto de conexión de la API de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-451">Yes: We can use Azure Pipelines with Microsoft-hosted agents to interact directly with Kubernetes API endpoint.</span></span>
  - <span data-ttu-id="ce8a1-452">No: se necesitan agentes autohospedados que puedan conectarse al punto de conexión de la API del clúster de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-452">No: We need self-hosted Agents that can connect to the Kubernetes cluster API endpoint.</span></span>

<span data-ttu-id="ce8a1-453">En los escenarios en los que los puntos de conexión de administración de Azure Stack Hub y la API de Kubernetes son accesibles a través de Internet, la implementación puede usar un agente hospedado por Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-453">In scenarios where the Azure Stack Hub management endpoints and Kubernetes API are accessible via the internet, the deployment can use a Microsoft-hosted agent.</span></span> <span data-ttu-id="ce8a1-454">Esta implementación producirá una arquitectura de aplicación similar a la que se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-454">This deployment will result in an application architecture as follows:</span></span>

<span data-ttu-id="ce8a1-455">[![Información general de la arquitectura pública](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-455">[![Public architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span></span>

<span data-ttu-id="ce8a1-456">Si no se puede acceder a los puntos de conexión de Azure Resource Manager, a la API de Kubernetes, o a ambos, directamente a través de Internet, podemos aprovechar un agente de compilación autohospedado para ejecutar los pasos de la canalización.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-456">If the Azure Resource Manager endpoints, Kubernetes API, or both aren't directly accessible via the Internet, we can leverage a self-hosted build agent to run the pipeline steps.</span></span> <span data-ttu-id="ce8a1-457">Este diseño necesita menos conectividad y se puede implementar solo con conectividad de red local en los puntos de conexión de Azure Resource Manager y la API de Kubernetes:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-457">This design needs less connectivity, and can be deployed with only on-premises network connectivity to Azure Resource Manager endpoints and the Kubernetes API:</span></span>

<span data-ttu-id="ce8a1-458">[![Información general sobre la arquitectura local](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="ce8a1-458">[![On-prem architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span></span>

> [!NOTE]
> <span data-ttu-id="ce8a1-459">**¿Qué ocurre con los escenarios sin conexión?**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-459">**What about disconnected scenarios?**</span></span> <span data-ttu-id="ce8a1-460">En escenarios en los que Azure Stack Hub o Kubernetes, o en ambos, no tienen puntos de conexión de administración con conexión a Internet, todavía es posible usar Azure DevOps para sus implementaciones.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-460">In scenarios where either Azure Stack Hub or Kubernetes or both of them do not have internet-facing management endpoints, it is still possible to use Azure DevOps for your deployments.</span></span> <span data-ttu-id="ce8a1-461">Puede usar un grupo de agentes autohospedado (que es un agente de DevOps que se ejecuta en el entorno local o en la propia instancia de Azure Stack Hub) o en un servidor completamente autohospedado de Azure DevOps Server local.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-461">You can either use a self-hosted Agent Pool (which is a DevOps Agent running on-premises or on Azure Stack Hub itself) or a completly self-hosted Azure DevOps Server on-premises.</span></span> <span data-ttu-id="ce8a1-462">El agente autohospedado solo necesita conectividad saliente a Internet HTTPS (TCP/443).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-462">The self-hosted agent needs only outbound HTTPS (TCP/443) Internet connectivity.</span></span>

<span data-ttu-id="ce8a1-463">El patrón puede usar un clúster de Kubernetes (implementado y organizado con el motor de AKS) en cada instancia de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-463">The pattern can use a Kubernetes cluster (deployed and orchestrated with AKS engine) on each Azure Stack Hub instance.</span></span> <span data-ttu-id="ce8a1-464">Incluye una aplicación que consta de un front-end, un nivel medio, servicios de back-end (por ejemplo, MongoDB) y un controlador de entrada basado en Nginx.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-464">It includes an application consisting of a frontend, a mid-tier, backend services (for example MongoDB), and an nginx-based Ingress Controller.</span></span> <span data-ttu-id="ce8a1-465">En lugar de usar una base de datos hospedada en el clúster K8s, puede usar los "almacenes de datos externos".</span><span class="sxs-lookup"><span data-stu-id="ce8a1-465">Instead of using a database hosted on the K8s cluster, you can leverage "external data stores".</span></span> <span data-ttu-id="ce8a1-466">Entre las opciones de base de datos se incluyen MySQL, SQL Server o cualquier tipo de base de datos hospedada fuera de Azure Stack Hub o en IaaS.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-466">Database options include MySQL, SQL Server, or any kind of database hosted outside of Azure Stack Hub or in IaaS.</span></span> <span data-ttu-id="ce8a1-467">Las configuraciones como esta no pertenecen a este ámbito.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-467">Configurations like this aren't in scope here.</span></span>

## <a name="partner-solutions"></a><span data-ttu-id="ce8a1-468">Soluciones de socios</span><span class="sxs-lookup"><span data-stu-id="ce8a1-468">Partner solutions</span></span>

<span data-ttu-id="ce8a1-469">Hay soluciones de asociados de Microsoft que pueden ampliar las funcionalidades de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-469">There are Microsoft Partner solutions that can extend the capabilities of Azure Stack Hub.</span></span> <span data-ttu-id="ce8a1-470">Estas soluciones han resultado útiles en implementaciones de aplicaciones que se ejecutan en clústeres de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-470">These solutions have been found useful in deployments of applications running on Kubernetes clusters.</span></span>  

## <a name="storage-and-data-solutions"></a><span data-ttu-id="ce8a1-471">Soluciones de almacenamiento y datos</span><span class="sxs-lookup"><span data-stu-id="ce8a1-471">Storage and data solutions</span></span>

<span data-ttu-id="ce8a1-472">Como se indica en la sección [Consideraciones a tener en cuenta sobre datos y almacenamiento](#data-and-storage-considerations), Azure Stack Hub no dispone actualmente de una solución nativa para replicar el almacenamiento en varias instancias.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-472">As described in [Data and storage considerations](#data-and-storage-considerations), Azure Stack Hub currently doesn't have a native solution to replicate storage across multiple instances.</span></span> <span data-ttu-id="ce8a1-473">A diferencia de Azure, la funcionalidad de replicación de almacenamiento en varias regiones no existe.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-473">Unlike Azure, the capability of replicating storage across multiple regions does not exist.</span></span> <span data-ttu-id="ce8a1-474">En Azure Stack Hub, cada instancia es su propia nube independiente.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-474">In Azure Stack Hub, each instance is its own distinct cloud.</span></span> <span data-ttu-id="ce8a1-475">Sin embargo, hay soluciones disponibles de asociados de Microsoft que permiten la replicación del almacenamiento en instancias de Azure Stack Hub y en Azure.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-475">However, solutions are available from Microsoft Partners that enable storage replication across Azure Stack Hubs and Azure.</span></span> 

<span data-ttu-id="ce8a1-476">**SCALITY**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-476">**SCALITY**</span></span>

<span data-ttu-id="ce8a1-477">[Scality](https://www.scality.com/) ofrece un almacenamiento a escala web que ha supuesto un gran impulso para las empresas digitales desde 2009.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-477">[Scality](https://www.scality.com/) delivers web-scale storage that has powered digital businesses since 2009.</span></span> <span data-ttu-id="ce8a1-478">Scality RING, nuestra solución de almacenamiento definido por software, convierte los servidores x86 en un bloque de almacenamiento ilimitado para cualquier tipo de datos (archivos y objetos) a escala de petabytes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-478">The Scality RING, our software-defined storage, turns commodity x86 servers into an unlimited storage pool for any type of data –file and object– at petabyte scale.</span></span>

<span data-ttu-id="ce8a1-479">**CLOUDIAN**</span><span class="sxs-lookup"><span data-stu-id="ce8a1-479">**CLOUDIAN**</span></span>

<span data-ttu-id="ce8a1-480">[Cloudian](https://www.cloudian.com/) simplifica el almacenamiento empresarial con almacenamiento escalable ilimitado que consolida los conjuntos de datos masivos en un entorno único y de fácil administración.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-480">[Cloudian](https://www.cloudian.com/) simplifies enterprise storage with limitless scalable storage that consolidates massive data sets to a single, easily managed environment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ce8a1-481">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="ce8a1-481">Next steps</span></span>

<span data-ttu-id="ce8a1-482">Para más información sobre los conceptos presentados en este artículo, consulte:</span><span class="sxs-lookup"><span data-stu-id="ce8a1-482">To learn more about concepts introduced in this article:</span></span>

- <span data-ttu-id="ce8a1-483">[Escalado de toda la nube](pattern-cross-cloud-scale.md) y [Patrones de aplicaciones distribuidas geográficamente](pattern-geo-distributed.md) en Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-483">[Cross-cloud scaling](pattern-cross-cloud-scale.md) and [Geo-distributed app patterns](pattern-geo-distributed.md) in Azure Stack Hub.</span></span>
- <span data-ttu-id="ce8a1-484">[Arquitectura de microservicios en Azure Kubernetes Service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-484">[Microservices architecture on Azure Kubernetes Service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span></span>

<span data-ttu-id="ce8a1-485">Cuando esté listo para probar la solución de ejemplo, continúe con la [guía de implementación de clústeres de Kubernetes de alta disponibilidad](solution-deployment-guide-highly-available-kubernetes.md).</span><span class="sxs-lookup"><span data-stu-id="ce8a1-485">When you're ready to test the solution example, continue with the [High availability Kubernetes cluster deployment guide](solution-deployment-guide-highly-available-kubernetes.md).</span></span> <span data-ttu-id="ce8a1-486">La guía de implementación proporciona instrucciones paso a paso para implementar y probar sus componentes.</span><span class="sxs-lookup"><span data-stu-id="ce8a1-486">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>